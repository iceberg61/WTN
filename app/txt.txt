import { LibraryMaterial } from "../types/library";

export const library: LibraryMaterial[] = [
  {
    id: "math-beg-1",
    title: "Basic Mathematics",
    description: "Introduction to numbers and operations",
    subject: "Mathematics",
    level: "Beginner",
    type: "PDF",
    isPremium: true,
    driveUrl: "https://drive.google.com/file/d/XXXXX/view",
    quizUrl: "https://forms.gle/XXXXX",
  },
  {
    id: "phy-int-1",
    title: "Physics ‚Äì Motion",
    description: "Understanding motion and speed",
    subject: "Physics",
    level: "Intermediate",
    type: "PDF",
    isPremium: false,
    driveUrl: "https://drive.google.com/file/d/YYYYY/view",
  },
];

// app/data/libraryStore.ts
import { LibraryMaterial } from "../types/library";

export const libraryStore: LibraryMaterial[] = [];
app\api\library\[id]\route.ts
import { NextResponse } from "next/server";
import { library } from "@/app/data/library";
import { getUserFromToken } from "@/lib/auth";
import User from "@/models/User";
import { connectDB } from "@/lib/connectDB";

export async function GET(
  req: Request,
  { params }: { params: Promise<{ id: string }> }
) {
  await connectDB();

  
  const { id } = await params;

  const userId = await getUserFromToken();

  if (!userId) {
    return NextResponse.json(
      { message: "Unauthorized" },
      { status: 401 }
    );
  }

  const user = await User.findById(userId).lean();

  if (!user) {
    return NextResponse.json(
      { message: "Invalid user" },
      { status: 401 }
    );
  }

  const material = library.find(
    (m) => m.id === id
  );

  if (!material) {
    return NextResponse.json(
      { message: "Material not found" },
      { status: 404 }
    );
  }

  // üîê DB-ENFORCED SUBSCRIPTION CHECK (this part is already correct)
  if (material.isPremium && !user.subscription) {
    return NextResponse.json(
      { message: "Subscription required" },
      { status: 403 }
    );
  }

  return NextResponse.json(material);
}
app\api\library\route.ts
import { NextRequest, NextResponse } from "next/server";
import { libraryStore } from "../../data/libraryStore";
import { LibraryMaterial } from "../../types/library";

// GET ‚Äî public (used by frontend)
export async function GET() {
  return NextResponse.json(libraryStore);
}

// POST ‚Äî admin only
export async function POST(req: NextRequest) {
  const body = await req.json();

  const {
    title,
    description,
    subject,
    level,
    type,
    isPremium,
    driveUrl,
    quizUrl,
    role,
  } = body;

  // üîê Admin check
  if (role !== "admin") {
    return NextResponse.json(
      { message: "Unauthorized" },
      { status: 403 }
    );
  }

  // üß™ Validation
  if (!title || !subject || !level || !type || !driveUrl) {
    return NextResponse.json(
      { message: "Missing required fields" },
      { status: 400 }
    );
  }

  const newMaterial: LibraryMaterial = {
    id: crypto.randomUUID(),
    title,
    description,
    subject,
    level,
    type,
    isPremium,
    driveUrl,
    quizUrl,
  };

  libraryStore.push(newMaterial);

  return NextResponse.json(newMaterial, { status: 201 });
}
